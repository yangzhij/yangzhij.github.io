<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>Hexo</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/15/linux免秘钥登录/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/15/linux免秘钥登录/" itemprop="url">linux免秘钥登录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-15T13:46:28+08:00">
                2019-02-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>//单台免秘钥登录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen    //生成密钥</span><br><span class="line">ssh-copy-id   root@10.0.0.1      //推到远程主机，此过程需要输入密码</span><br><span class="line">ssh 10.0.0.1   //测试</span><br></pre></td></tr></table></figure></p>
<p>//比如3台主机相互免密码登录，就需要在3台上面都执行以上命令，新的秘钥会追加到相应文件，不会影响原来的。即：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.在3台上都生成秘钥  ssh-keygen</span><br><span class="line">2.推送到其他两台 ssh-copy-id   root@10.0.0.2</span><br><span class="line">3.测试</span><br></pre></td></tr></table></figure></p>
<p>//比如几十台都通过免秘钥登陆呢？这时候就需要ansible了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">vim  /etc/ansible/hosts </span><br><span class="line">[jenkins]·</span><br><span class="line">172.20.100.126</span><br><span class="line">172.20.100.217</span><br><span class="line">[jjaaa]</span><br><span class="line">172.20.100.218</span><br><span class="line">172.20.100.219</span><br><span class="line">执行下列语句(all是所有的，也可指定单个组，如下jjaaa)，如果ip的密码都是一样的，执行的时候需输入一次密码</span><br><span class="line">ansible all -m authorized_key -a &quot;user=root key=&apos;&#123;&#123; lookup(&apos;file&apos;, &apos;/root/.ssh/id_rsa.pub&apos;)&#125;&#125;&apos; path=&apos;/root/.ssh/authorized_keys&apos; manage_dir=no&quot; --ask-pass -c paramiko</span><br><span class="line">ansible jjaaa -m authorized_key -a &quot;user=root key=&apos;&#123;&#123; lookup(&apos;file&apos;, &apos;/root/.ssh/id_rsa.pub&apos;)&#125;&#125;&apos; path=&apos;/root/.ssh/authorized_keys&apos; manage_dir=no&quot; --ask-pass -c paramiko</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[jenkins]</span><br><span class="line">172.20.100.126 ansible_ssh_pass=&quot;old123456&quot;</span><br><span class="line">172.20.100.217 ansible_ssh_pass=&quot;123456</span><br><span class="line">如果密码不同  需要自定义</span><br><span class="line">ansible all -m authorized_key -a &quot;user=root key=&apos;&#123;&#123; lookup(&apos;file&apos;, &apos;/root/.ssh/id_rsa.pub&apos;)&#125;&#125;&apos; path=&apos;/root/.ssh/authorized_keys&apos; manage_dir=no&quot; --ask-pass -c paramiko</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[jenkins]</span><br><span class="line">172.20.100.126</span><br><span class="line">172.20.100.217</span><br><span class="line">172.20.100.157 ansible_ssh_pass=&quot;ley123456&quot;</span><br><span class="line">如果密码不同  需要自定义，</span><br><span class="line"></span><br><span class="line">看到这样的，&quot;Are you sure you want to continue connecting (yes/no)?&quot;。。。。直接回车就可以了</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/13/挂载磁盘/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/13/挂载磁盘/" itemprop="url">挂载磁盘</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-13T18:26:42+08:00">
                2019-02-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>//挂载硬盘：<br>1.挂载哪块磁盘呢？<br>2.挂载到哪呢？</p>
<p>步骤如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">1.查看磁盘分区信息</span><br><span class="line">fdisk -l</span><br><span class="line"></span><br><span class="line">2.输入fdisk /dev/sdb给硬盘进行分区，输入n回车新建分区，接着再输入p回车新建主分区</span><br><span class="line">fdisk /dev/sdb</span><br><span class="line">w  帮助命令</span><br><span class="line">n   新增</span><br><span class="line">p  主分区</span><br><span class="line">一路回车</span><br><span class="line">w  写入磁盘并退出</span><br><span class="line"></span><br><span class="line">对硬盘进行格式化：</span><br><span class="line">mkfs.xfs /dev/sdb1            </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">让后加的分区能够启动时自动挂载,需要把配置写入文件 /etc/fstab， 如下，挂载到home目录下</span><br><span class="line">vi /etc/fstab </span><br><span class="line">/dev/sdb1 /home                   xfs     defaults        0 0</span><br><span class="line"></span><br><span class="line">前3段： 分区名    挂载点   文件系统名称   </span><br><span class="line"></span><br><span class="line">加载文件/etc/fstab中描述的所有文件系统</span><br><span class="line">mount -a     </span><br><span class="line"></span><br><span class="line">然后df -lh 查看就有了</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/cipan1.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/cipan1.png"><br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/cipan2.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/cipan2.png"><br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/cipan3.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/cipan3.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/13/zabbix监控nginx/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/13/zabbix监控nginx/" itemprop="url">zabbix监控nginx</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-13T15:23:16+08:00">
                2019-02-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>zabbix监控nginx的性能状态，主要包括：</strong><br>nginx-accepts:  nginx所接受的客户端连接数<br>nginx-active：  当前活跃的客户端连接数<br>nginx-handled:  已成功的客户端连接数<br>nginx-requests：客户端请求数<br>nginx-ping<br>nginx-reading<br>nginx-waiting<br>nginx-writing<br><strong>—————操作如下：前提：nginx运行正常</strong><br>cd /etc/nginx/conf.d/<br>新建status.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost zabbix]# more /etc/nginx/conf.d/status.conf </span><br><span class="line">server &#123;</span><br><span class="line">    listen 10080;</span><br><span class="line">    access_log off;</span><br><span class="line">    server_name localhost;</span><br><span class="line">    root /var/www/html;</span><br><span class="line"></span><br><span class="line">    location /nginx_status &#123;</span><br><span class="line">       stub_status on;</span><br><span class="line">       access_log off;</span><br><span class="line">       allow 172.20.100.0/24;</span><br><span class="line">       deny all;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>cd /etc/zabbix/<br>more nginx_status.sh<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#! /bin/bash</span><br><span class="line"></span><br><span class="line">HOST=&quot;172.20.100.218&quot;</span><br><span class="line">PORT=&quot;8018&quot;</span><br><span class="line"># 监测nginx进程是否存在</span><br><span class="line">function ping &#123;</span><br><span class="line">    /sbin/pidof nginx | wc -l</span><br><span class="line">&#125;</span><br><span class="line"># 监测nginx性能</span><br><span class="line">function active &#123;</span><br><span class="line">    /usr/bin/curl &quot;http://$HOST:$PORT/nginx_status/&quot; 2&gt;/dev/null| grep &apos;Active&apos; | awk &apos;&#123;print $NF&#125;&apos;</span><br><span class="line">&#125;</span><br><span class="line">function reading &#123;</span><br><span class="line">    /usr/bin/curl &quot;http://$HOST:$PORT/nginx_status/&quot; 2&gt;/dev/null| grep &apos;Reading&apos; | awk &apos;&#123;print $2&#125;&apos;</span><br><span class="line">&#125;</span><br><span class="line">function writing &#123;</span><br><span class="line">    /usr/bin/curl &quot;http://$HOST:$PORT/nginx_status/&quot; 2&gt;/dev/null| grep &apos;Writing&apos; | awk &apos;&#123;print $4&#125;&apos;</span><br><span class="line">&#125;</span><br><span class="line">function waiting &#123;</span><br><span class="line">    /usr/bin/curl &quot;http://$HOST:$PORT/nginx_status/&quot; 2&gt;/dev/null| grep &apos;Waiting&apos; | awk &apos;&#123;print $6&#125;&apos;</span><br><span class="line">&#125;</span><br><span class="line">function accepts &#123;</span><br><span class="line">    /usr/bin/curl &quot;http://$HOST:$PORT/nginx_status/&quot; 2&gt;/dev/null| awk NR==3 | awk &apos;&#123;print $1&#125;&apos;</span><br><span class="line">&#125;</span><br><span class="line">function handled &#123;</span><br><span class="line">    /usr/bin/curl &quot;http://$HOST:$PORT/nginx_status/&quot; 2&gt;/dev/null| awk NR==3 | awk &apos;&#123;print $2&#125;&apos;</span><br><span class="line">&#125;</span><br><span class="line">function requests &#123;</span><br><span class="line">    /usr/bin/curl &quot;http://$HOST:$PORT/nginx_status/&quot; 2&gt;/dev/null| awk NR==3 | awk &apos;&#123;print $3&#125;&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$1</span><br></pre></td></tr></table></figure></p>
<p>脚本写完先在本地测试一下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x nginx_status.sh</span><br><span class="line">sh /etc/zabbix/nginx_status.sh active</span><br></pre></td></tr></table></figure></p>
<p>配置/etc/zabbix/zabbix_agentd.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UnsafeUserParameters=1</span><br></pre></td></tr></table></figure></p>
<p>在脚本中添加定义以下各项的键值,新建nginx_status.conf，输入以下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">more /etc/zabbix/zabbix_agentd.d/nginx_status.conf</span><br><span class="line">UserParameter=nginx.status[*],/etc/zabbix/nginx_status.sh $1</span><br></pre></td></tr></table></figure></p>
<p>zabbix服务端使用zabbix_get 测试获取数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zabbix_get -s 172.20.100.218 -k nginx.status[active]</span><br></pre></td></tr></table></figure></p>
<p>服务端测试正常后就可以在web界面配置监控了，</p>
<p>zabbix的配置流程大致如下：<br>创建主机组 -》添加主机 -》 创建监控模板 -》 创建应用集 -》创建监控项 -》 创建图像—》创建触发器 -》 创建事件 -》创建处理动作 -》 创建用户组与用户 -》创建告警方式</p>
<p>配置–模板–创建模板–Template App Nginx–更新<br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/zbx_ngx1.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/zbx_ngx1.png"><br>–点击该模板的应用集–创建应用集–nginx–更新<br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/zbx_ngx2.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/zbx_ngx2.png"><br>–点击监控项，创建监控项<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">监控项名称及其对应的键值，下图举一例</span><br><span class="line">nginx-accepts    nginx.status[accepts]</span><br><span class="line">nginx-active     nginx.status[active]</span><br><span class="line">nginx-handled    nginx.status[handled]</span><br><span class="line">nginx-requests   nginx.status[requests]</span><br><span class="line">nginx-ping       nginx.status[ping]</span><br><span class="line">nginx-reading    nginx.status[reading]</span><br><span class="line">nginx-waiting    nginx.status[waiting]</span><br><span class="line">nginx-writing    nginx.status[writing]</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/zbx_ngx3.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/zbx_ngx3.png"><br>–触发器–创建触发器<br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/zbx_ngx4.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/zbx_ngx4.png"><br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/zbx_ngx5.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/zbx_ngx5.png"><br>就只给这两个创建触发器，最后效果图：<br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/zbx_ngx6.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/zbx_ngx6.png"><br>至此完毕！<br>最后把这个模板添加到相应的主机组就可以了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/12/Grafana5安装配置及流量监控/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/12/Grafana5安装配置及流量监控/" itemprop="url">centos7下 Grafana5安装配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-12T10:22:20+08:00">
                2019-02-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>本文档前提条件：Zabbix监控服务器、客户端都已经部署完成，被监控主机已添加完成，Zabbix监控运行正常</strong><br>//安装Grafana 5<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">方式1：官方源直接安装</span><br><span class="line">yum -y install https://dl.grafana.com/oss/release/grafana-5.4.2-1.x86_64.rpm</span><br><span class="line">方式2：使用安装包</span><br><span class="line">yum -y install initscripts fontconfig</span><br><span class="line">wget https://dl.grafana.com/oss/release/grafana-5.4.2-1.x86_64.rpm</span><br><span class="line">rpm -Uvh grafana-5.4.2-1.x86_64.rpm</span><br></pre></td></tr></table></figure></p>
<p>//安装服务端图像呈现组件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install fontconfig freetype* urw-fonts -y</span><br></pre></td></tr></table></figure></p>
<p>//启动grafana,并设置开机启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start grafana-server            #启动服务</span><br><span class="line">systemctl enable grafana-server.service          #设置开机自启</span><br><span class="line">systemctl status grafana-server            #查看服务是否正常启动</span><br></pre></td></tr></table></figure></p>
<p>//开启防火墙放行3000端口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-port=3000/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure></p>
<p>//访问，默认用户名密码：admin/admin，第一次登陆会要求改密码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.20.100.219:3000</span><br></pre></td></tr></table></figure></p>
<p>//插件安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">安装grafana-zabbix插件</span><br><span class="line">grafana-cli plugins install alexanderzobnin-zabbix-app</span><br><span class="line"></span><br><span class="line">安装grafana-clock-panel插件：</span><br><span class="line">grafana-cli plugins install grafana-clock-panel</span><br><span class="line"></span><br><span class="line">安装grafana饼图插件</span><br><span class="line">grafana-cli plugins install grafana-piechart-panel</span><br></pre></td></tr></table></figure></p>
<p>//重启grafana服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart grafana-server</span><br></pre></td></tr></table></figure></p>
<p>点击进去拉到最后，点击zabbix，点击enable，然后最左侧就可以看到zabbix的图标了。<br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/gr1.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/gr1.png"><br>下一步开始配置数据源<br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/gr2.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/gr2.png"><br>Zabbix的URL地址为<a href="http://172.20.100.219/zabbix/api_jsonrpc.php" target="_blank" rel="noopener">http://172.20.100.219/zabbix/api_jsonrpc.php</a><br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/gr3.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/gr3.png"><br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/gr4.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/gr4.png"><br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/gr5.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/gr5.png"><br>点进去选择<br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/gr6.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/gr6.png"></p>
<p><strong>自定义监控网卡流量</strong><br>//最终效果图：<br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/gra-eth0-1.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/gra-eth0-1.png"><br>//操作如下：<br>Dashboards-&gt;home-&gt;New dashboards-&gt;Graph<br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/gra-eth0-2.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/gra-eth0-2.png"><br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/gra-eth0-3.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/gra-eth0-3.png"><br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/gra-eth0-4.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/gra-eth0-4.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/11/zabbix监控服务端口/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/11/zabbix监控服务端口/" itemprop="url">zabbix监控服务端口</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-11T16:00:58+08:00">
                2019-02-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1.被监控端上编写脚本，注意两个脚本属主为zabbix:zabbix<br>port_check.sh为端口自发现脚本,编写完后添加执行权限chmod +x port_check.sh<br>port.conf为指定的监控端口号</p>
<p>具体操作<br>编辑port_check.sh<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">mkdir /etc/zabbix/script/</span><br><span class="line">cd /etc/zabbix/script/</span><br><span class="line">more port_check.sh</span><br><span class="line">#/bin/bash</span><br><span class="line">CONFIG_FILE=/etc/zabbix/script/port.conf</span><br><span class="line">Check()&#123;</span><br><span class="line">    grep -vE &apos;(^ *#|^$)&apos; $&#123;CONFIG_FILE&#125; | grep -vE &apos;^ *[0-9]+&apos; &amp;&gt; /dev/null</span><br><span class="line">    if [ $? -eq 0 ]</span><br><span class="line">    then</span><br><span class="line">        echo Error: $&#123;CONFIG_FILE&#125; Contains Invalid Port.</span><br><span class="line">        exit 1</span><br><span class="line">    else</span><br><span class="line">        portarray=($(grep -vE &apos;(^ *#|^$)&apos; $&#123;CONFIG_FILE&#125; | grep -E &apos;^ *[0-9]+&apos;))</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line">PortDiscovery()&#123;</span><br><span class="line">    length=$&#123;#portarray[@]&#125;</span><br><span class="line">    printf &quot;&#123;\n&quot;</span><br><span class="line">    printf  &apos;\t&apos;&quot;\&quot;data\&quot;:[&quot;</span><br><span class="line">    for ((i=0;i&lt;$length;i++))</span><br><span class="line">      do</span><br><span class="line">        printf &apos;\n\t\t&#123;&apos;</span><br><span class="line">        printf &quot;\&quot;&#123;#TCP_PORT&#125;\&quot;:\&quot;$&#123;portarray[$i]&#125;\&quot;&#125;&quot;</span><br><span class="line">        if [ $i -lt $[$length-1] ];then</span><br><span class="line">                    printf &apos;,&apos;</span><br><span class="line">        fi</span><br><span class="line">      done</span><br><span class="line">    printf  &quot;\n\t]\n&quot;</span><br><span class="line">    printf &quot;&#125;\n&quot;</span><br><span class="line">&#125;</span><br><span class="line">port()&#123;</span><br><span class="line">    Check</span><br><span class="line">    PortDiscovery</span><br><span class="line">&#125;</span><br><span class="line">port</span><br></pre></td></tr></table></figure></p>
<p>同目录下编辑port.conf，配置文件port.conf每个端口号一行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">more port.conf</span><br><span class="line">9551  </span><br><span class="line">9552  </span><br><span class="line">9050  </span><br><span class="line">9052  </span><br><span class="line">7052  </span><br><span class="line">8050  </span><br><span class="line">9053  </span><br><span class="line">5150</span><br></pre></td></tr></table></figure></p>
<p>更改属主<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/zabbix/script/</span><br><span class="line">chown zabbix.zabbix ./*</span><br></pre></td></tr></table></figure></p>
<p>2.修改被监控端的zabbix_agent.conf配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/zabbix/zabbix_agentd.conf</span><br><span class="line">UserParameter=port.alert,/etc/zabbix/script/port_check.sh</span><br></pre></td></tr></table></figure></p>
<p>3.重启agent端zabbix服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ystemctl restart zabbix-agent</span><br></pre></td></tr></table></figure></p>
<p>4.服务端用zabbix-get看能否获取数据:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@elk-node1 dejavu]#  zabbix_get -s 172.20.100.128 -k port.alert</span><br><span class="line">&#123;</span><br><span class="line">        &quot;data&quot;:[</span><br><span class="line">                &#123;&quot;&#123;#TCP_PORT&#125;&quot;:&quot;9551&quot;&#125;,</span><br><span class="line">                &#123;&quot;&#123;#TCP_PORT&#125;&quot;:&quot;9552&quot;&#125;,</span><br><span class="line">                &#123;&quot;&#123;#TCP_PORT&#125;&quot;:&quot;9050&quot;&#125;,</span><br><span class="line">                &#123;&quot;&#123;#TCP_PORT&#125;&quot;:&quot;9052&quot;&#125;,</span><br><span class="line">                &#123;&quot;&#123;#TCP_PORT&#125;&quot;:&quot;7052&quot;&#125;,</span><br><span class="line">                &#123;&quot;&#123;#TCP_PORT&#125;&quot;:&quot;8050&quot;&#125;,</span><br><span class="line">                &#123;&quot;&#123;#TCP_PORT&#125;&quot;:&quot;9053&quot;&#125;,</span><br><span class="line">                &#123;&quot;&#123;#TCP_PORT&#125;&quot;:&quot;5150&quot;&#125;</span><br><span class="line">        ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>5.接下来就在zabbix管理web添加自动发现规则：配置在默认的模板Template OS Linux里即可<br>添加自动发现规则：<br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/zaPort1.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/zaPort1.png"><br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/zaPort2.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/zaPort2.png"><br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/zaPort3.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/zaPort3.png"><br>之后点击刚创建的自动发现规则tcp port discover，开始添加监控项原型<br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/zaPort4.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/zaPort4.png"><br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/zaPort5.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/zaPort5.png"><br>完毕之后，添加触发器报警：值为0则端口不通，值为1则端口通<br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/zaPort6.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/zaPort6.png"><br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/zaPort7.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/zaPort7.png"><br>完成之后，可以再弄个图形原型<br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/zaPort8.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/zaPort8.png"><br>添加完之后等一会儿图就会生成了，如下图所示。然后可以测试这关闭几个进程来验证。<br><img src="https://raw.githubusercontent.com/yangzhij/myself-images/master/zaPort9.png" alt="https://raw.githubusercontent.com/yangzhij/myself-images/master/zaPort9.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/09/Mongodb副本集/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/09/Mongodb副本集/" itemprop="url">Mongodb副本集</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-09T20:47:04+08:00">
                2019-02-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>replication set</strong>： 副本集，多台服务器维护相同的数据副本，提高服务器的可用性.<br>最小的副本集也应该具备一个primary节点和两个secondary节点。两个节点的副本集不具备真正的故障转移能力。</p>
<p><strong>整个流程说明：</strong><br> 本次是在一台机器上启动了3个实例进行模拟测试，区别于端口。副本集完成之后，27017是primary，27018和27019为Secondary。在27017上插入数据，27018和27019都可以读到。 把27017停掉之后，27018会从Secondary变成primary。27019还是Secondary。在27018上插入数据，27019也可以读到。当27017重新起来后，会从原来的primary变成Secondary，数据也会同步的。</p>
<p><strong>注意：</strong><br>当副本集中所有的Secondary都宕机、或者副本集中只剩下一个节点，则该节点只会成为Secondary节点（即使是primary节点也只能降级为secondary节点），也就意味着整个集群此时只能进行读操作而不能进行写操作，当其他节点恢复之后，之前的primary节点仍然是primary节点。<strong>默认情况下，Secondary是不提供服务的，即不能读和写。在特殊情况下需要读的话则需要：rs.slaveOk()，只对当前连接有效。</strong></p>
<p><strong>//下载</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local</span><br><span class="line">wget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-4.0.4.tgz</span><br><span class="line">tar xvf mongodb-linux-x86_64-rhel70-4.0.4.tgz</span><br><span class="line">mv mongodb-linux-x86_64-rhel70-4.0.4 mongodb</span><br></pre></td></tr></table></figure></p>
<p><strong>//创建目录</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /home/m17 /home/m18 /home/m19 /home/mlog</span><br></pre></td></tr></table></figure></p>
<p><strong>//启动实例，且声明实例属于某复制集。  本次是在一台机器上启动了3个实例，区别于端口。实际生产中可以3台机器各自启动一个，端口可以都是27017。</strong><br>说明：启动MongoDB有2种方式，一是直接指定配置参数，二是指定配置文件。本次通过指定配置参数启动：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//启动</span><br><span class="line">/usr/local/mongodb/bin/mongod --dbpath /home/m17 --logpath /home/mlog/m17.log --port 27017 --bind_ip 0.0.0.0 --fork --smallfiles --replSet rs2</span><br><span class="line">/usr/local/mongodb/bin/mongod --dbpath /home/m18 --logpath /home/mlog/m18.log --port 27018 --bind_ip 0.0.0.0 --fork --smallfiles --replSet rs2</span><br><span class="line">/usr/local/mongodb/bin/mongod --dbpath /home/m19 --logpath /home/mlog/m19.log --port 27019 --bind_ip 0.0.0.0 --fork --smallfiles --replSet rs2</span><br><span class="line">//参数说明</span><br><span class="line">--dbpath             #存放数据的路径</span><br><span class="line">--logpath            #存放日志的路径</span><br><span class="line">--bind_ip            #绑定ip。默认127.0.0.1，只能通过本地连接。</span><br><span class="line">--fork               #后台启动</span><br><span class="line">--smallfiles         #使用较小的默认数据文件大小。</span><br><span class="line">--replSet rs2        #指定一个副本集名称rs2作为参数，所有主机都必须有相同的名称作为同一个副本集。</span><br></pre></td></tr></table></figure></p>
<p><strong>//初始化</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/mongodb/bin/</span><br><span class="line">./mongo</span><br><span class="line">&gt; rs.initiate(&#123;&quot;_id&quot;:&quot;rs2&quot;,&quot;members&quot;:[</span><br><span class="line">&#123;&quot;_id&quot;:0,</span><br><span class="line">&quot;host&quot;:&quot;172.20.100.219:27017&quot;,</span><br><span class="line">&quot;priority&quot;:1</span><br><span class="line">&#125;,</span><br><span class="line">&#123;&quot;_id&quot;:1,</span><br><span class="line">&quot;host&quot;:&quot;172.20.100.219:27018&quot;,</span><br><span class="line">&quot;priority&quot;:1</span><br><span class="line">&#125;,</span><br><span class="line">&#123;&quot;_id&quot;:2,</span><br><span class="line">&quot;host&quot;:&quot;172.20.100.219:27019&quot;,</span><br><span class="line">&quot;priority&quot;:1</span><br><span class="line">&#125;</span><br><span class="line">]&#125;)</span><br></pre></td></tr></table></figure></p>
<p><strong>//主节点PRIMARY插入数据测试</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//测试1</span><br><span class="line">rs2:PRIMARY&gt; use test</span><br><span class="line">rs2:PRIMARY&gt; db.user.insert(&#123;uid:1,name:&apos;lily&apos;&#125;);</span><br><span class="line">rs2:PRIMARY&gt; db.user.find()</span><br><span class="line"></span><br><span class="line">//测试2</span><br><span class="line">rs2:PRIMARY&gt; for(var i=0;i&lt;10000;i++)&#123;db.test.insert(&#123;&quot;name&quot;:&quot;test&quot;+i,&quot;age&quot;:123&#125;)&#125;</span><br><span class="line">rs2:PRIMARY&gt; db.test.count()</span><br></pre></td></tr></table></figure></p>
<p><strong>//在Secondary上查看是否已经同步</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//测试1</span><br><span class="line">rs2:SECONDARY&gt; rs.slaveOk()</span><br><span class="line">rs2:SECONDARY&gt; db.user.find()</span><br><span class="line">//测试2</span><br><span class="line">rs2:SECONDARY&gt; rs.slaveOk()</span><br><span class="line">rs2:SECONDARY&gt; db.test.count()</span><br></pre></td></tr></table></figure></p>
<p><strong>增删节点，注意：增删节点都在PRIMARY节点执行</strong><br>//添加节点到副本集<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rs2:PRIMARY&gt; rs.add(&quot;172.20.100.219:27016&quot;)</span><br><span class="line"></span><br><span class="line">rs2:PRIMARY&gt; rs.status()  //查看副本集的状态</span><br></pre></td></tr></table></figure></p>
<p>//从副本集移除某节点<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rs2:PRIMARY&gt; rs.remove(&quot;172.20.100.219:27016&quot;)</span><br><span class="line">rs2:PRIMARY&gt; rs.status()  //查看副本集的状态</span><br></pre></td></tr></table></figure></p>
<p><strong>手动切换Primary节点到自己给定的节点</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">rs2:PRIMARY&gt; rs.conf()   #查看配置</span><br><span class="line"></span><br><span class="line">&quot;_id&quot; : &quot;rs2&quot;,       副本集名称</span><br><span class="line">&quot;version&quot; : 7,       每改变一次集群的配置，副本集的version都会加1</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">members里面其中一个参数：</span><br><span class="line">priority  ：优先集，因为最开始默认的都是1，只需要把给定的服务器的priority加到这些主机中最大的即可。</span><br><span class="line"></span><br><span class="line">rs2:PRIMARY&gt; rs.status() #查看状态</span><br><span class="line"></span><br><span class="line">rs2:PRIMARY&gt; cfg=rs.conf()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rs2:PRIMARY&gt; cfg.members[1].priority=2  #修改priority         [1] 相当于python里面的下标，更改第几台主机的priority=2，从0开始算第一台</span><br><span class="line">rs2:PRIMARY&gt; rs.reconfig(cfg)           #重新加载配置文件，强制副本集进行一次选举，优先级高的成为Primary。在这期间整个集群的所有节点都是secondary。</span><br><span class="line"></span><br><span class="line">rs2:PRIMARY&gt; rs.status()      #查看状态，更改完后需要等一下才能生效，所以第一遍查看状态看不出来，多查看两次就出来效果了。</span><br></pre></td></tr></table></figure></p>
<p><strong>//添加仲裁节点  “stateStr” : “ARBITER”</strong>(4版本开始已经没有必要了)<br>副本集要求参与选举投票(vote)的节点数为奇数，为了实现 Automatic Failover（自动故障转移）引入另一类节点：仲裁者（arbiter），仲裁者只参与投票不拥有实际的数据，并且不提供任何服务，因此它对物理资源要求不严格。</p>
<p><strong>测试发现</strong>，当整个副本集集群中达到50%的节点（包括仲裁节点）不可用的时候，剩下的节点只能成为secondary节点，整个集群只能读不能写。<br>当集群中有1个primary节点，1个secondary节点和1个arbiter节点，这时即使 primary节点挂了，剩下的secondary节点也会自动成为primary节点。<br>因为仲裁节点不复制数据，因此<strong>利用仲裁节点可以实现最少的机器开销达到两个节点热备的效果。</strong></p>
<p><strong>如果要把之前的某一节点变成仲裁节点，则需要：</strong><br>1.先从副本集中移除该节点<br>2.杀掉该进程<br>3.删除该节点的数据目录和日志目录<br>4.重新创建好数据目录<br>5.重新启动然后添加到副本集rs.addArb(“172.20.100.219:27019”)</p>
<p><strong>//运行rs.status()发现某从节点statestr一直是STARTUP2，处理如下：</strong><br>1.先从副本集中移除该节点<br>2.杀掉该进程<br>3.删除该节点的数据目录和日志目录<br>4.重新创建好数据目录<br>5.重新启动然后添加到副本集</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/06/rabbitMQ集群/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/06/rabbitMQ集群/" itemprop="url">rabbitMQ集群</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-06T11:43:16+08:00">
                2019-02-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>rabbitmq：消息队列。作为消息中间件，一般以集群方式部署，主要提供消息的接受和发送，实现各服务之间的消息异步。</p>
<p>原理：<br>RabbitMQ底层是通过Erlang架构来实现的。RabbitMQ底层是通过Erlang架构来实现的，所以rabbitmqctl会启动Erlang节点，并基于Erlang节点来使用Erlang系统连接RabbitMQ节点，在连接过程中需要正确的Erlang Cookie和节点名称，<br>Erlang节点通过交换Erlang Cookie以获得认证。<br>所以部署rabbitmq分布式集群时要先安装erlang，并把其中一个服务的cookie复制到另外的节点。</p>
<p>rabbitmq集群中，各个rabbitmq为对等节点，即每个节点均提供给客户端连接，进行消息的接收和发送。<br>节点分为内存节点和磁盘节点，一般的，为了防止机器重启后的消息消失，均应建立为磁盘节点；</p>
<p>RabbitMQ的Cluster集群模式一般分为两种，普通模式和镜像模式。</p>
<p>1.必备工具安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install vim wget ntp lrzsz</span><br></pre></td></tr></table></figure></p>
<p>2.确定3台主机的时间同步<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum -y install chrony</span><br><span class="line">timedatectl set-timezone Asia/Shanghai</span><br><span class="line">systemctl enable chronyd.service</span><br><span class="line">systemctl start chronyd.service</span><br><span class="line">hwclock --systohc</span><br></pre></td></tr></table></figure></p>
<p>3.配置3台机器的/etc/hosts文件: 在/etc/hosts中，绑定三台机器的ip和主机名（erlang是通过主机名来连接服务，必须保证各个主机名之间可以ping通。如果主机名ping不通，rabbitmq服务启动会失败。）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts 添加（注意中间空格为tab符号）</span><br><span class="line">192.168.0.101 rabbitmq-1</span><br><span class="line">192.168.0.102 rabbitmq-2</span><br><span class="line">192.168.0.103 rabbitmq-3</span><br><span class="line">scp /etc/hosts root@192.168.0.102:/etc/hosts      拷贝到其他机器</span><br><span class="line">scp /etc/hosts root@192.168.0.103:/etc/hosts</span><br></pre></td></tr></table></figure></p>
<p>4.分别在3台上面执行安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc glibc-devel make ncurses-devel openssl-devel xmlto perl wget</span><br><span class="line">wget http://www.rabbitmq.com/releases/erlang/erlang-19.0.4-1.el6.x86_64.rpm</span><br><span class="line">rpm -ivh erlang-19.0.4-1.el6.x86_64.rpm</span><br><span class="line">wget https://dl.bintray.com/rabbitmq/rabbitmq-server-rpm/rabbitmq-server-3.6.12-1.el6.noarch.rpm</span><br><span class="line">rpm --import https://www.rabbitmq.com/rabbitmq-release-signing-key.asc</span><br><span class="line">yum -y makecache</span><br><span class="line">yum -y install socat</span><br><span class="line">rpm -ivh rabbitmq-server-3.6.12-1.el6.noarch.rpm</span><br></pre></td></tr></table></figure></p>
<p>5.<strong>erlang.cookie是erlang实现分布式的必要文件，erlang分布式的每个节点上要保持相同的。</strong>同时要保证cookie文件的权限是400,不然节点之间就无法通信。打开rabbitmq-1服务器的/var/lib/rabbitmq/.erlang.cookie中的内容,复制到其他节点上。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /var/lib/rabbitmq/</span><br><span class="line">scp .erlang.cookie root@192.168.0.102:/var/lib/rabbitmq/</span><br></pre></td></tr></table></figure></p>
<p>6.系统调优<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">文件末尾添加下面4行</span><br><span class="line">vi /etc/security/limits.conf</span><br><span class="line">* soft nofile 102400</span><br><span class="line">* hard nofile 102400</span><br><span class="line"></span><br><span class="line">* soft nproc 102400</span><br><span class="line">* hard nproc 102400</span><br><span class="line"></span><br><span class="line">//文件末未添加</span><br><span class="line">vi /etc/sysctl.conf</span><br><span class="line">fs.file-max=102400</span><br><span class="line"></span><br><span class="line">//可以打开的最大文件数量及用户最大可用的进程数</span><br><span class="line">ulimit -n 65000</span><br><span class="line">ulimit -u 65000</span><br></pre></td></tr></table></figure></p>
<p>7.分别启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//启动并查看状态</span><br><span class="line">systemctl start rabbitmq-server.service</span><br><span class="line">systemctl status rabbitmq-server.service</span><br><span class="line"></span><br><span class="line">//开启网页管理插件</span><br><span class="line">rabbitmq-plugins enable rabbitmq_management</span><br><span class="line">systemctl restart rabbitmq-server.service</span><br></pre></td></tr></table></figure></p>
<p>8.集群节点添加（添加新节点）<br>将rabbit@rabbitmq-1作为集群主节点，在其他节点上分别执行如下命令，以加入集群中.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl stop_app                            # 仅停止应用</span><br><span class="line">rabbitmqctl reset                                # 重置应用</span><br><span class="line">rabbitmqctl join_cluster rabbit@rabbitmq-1           # 加入rabbit@rabbitmq-1集群</span><br><span class="line">rabbitmqctl start_app                            # 开启应用</span><br><span class="line">rabbitmqctl cluster_status                        # 都查看集群状态</span><br></pre></td></tr></table></figure></p>
<p>9.账号管理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl add_user admin admin                # 添加账号</span><br><span class="line">rabbitmqctl set_user_tags admin administrator    # 添加权限</span><br><span class="line">rabbitmqctl delete_user guest                    # 删除用户</span><br><span class="line">rabbitmqctl change_password 用户名 密码            # 修改用户的密码</span><br><span class="line">rabbitmqctl list_users                            # 查看当前用户列表</span><br><span class="line"></span><br><span class="line">//vhost管理</span><br><span class="line">rabbitmqctl add_vhost vhostname        # 创建vhost</span><br><span class="line">rabbitmqctl delete_vhost vhostname     # 删除vhost</span><br><span class="line">rabbitmqctl list_vhosts                # 查看所有虚拟主机信息</span><br><span class="line">rabbitmqctl set_permissions -p v_host user  &quot;.*&quot;  &quot;.*&quot;  &quot;.*&quot;   ##绑定权限，并且具备读写的权限</span><br><span class="line">rabbitmqctl list_queues                # 显示所有队列</span><br></pre></td></tr></table></figure></p>
<p>10.分别在3台主机上查看连接的状态<br>rabbitmqctl cluster_status</p>
<p>–第一行是集群中的节点成员，disc表示这些都是磁盘节点。<br>–第二行是正在运行的节点成员</p>
<p>11.节点退出集群(从集群中移除节点)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">假设要把rabbitmq-2退出集群，在rabbitmq2上执行</span><br><span class="line">#rabbitmqctl stop_app</span><br><span class="line">#rabbitmqctl reset</span><br><span class="line">#rabbitmqctl start_app</span><br><span class="line"></span><br><span class="line">然后在集群主节点上执行</span><br><span class="line"># rabbitmqctl forget_cluster_rabbitmq rabbit@rabbitmq-2</span><br></pre></td></tr></table></figure></p>
<p>12.可以删除默认guest用户<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl delete_user guest</span><br></pre></td></tr></table></figure></p>
<p>haproxy 对mq进行负载<br>keepalive    提供统一入口，防止单点故障</p>
<p><strong>安装keepalived，提供一个入口</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install keepalived </span><br><span class="line">systemctl enable keepalived</span><br><span class="line">systemctl start keepalived</span><br></pre></td></tr></table></figure></p>
<p>分别编辑三台的配置文件vim /etc/keepalived/keepalived.conf，内容如下：priority 分别为101,102,103<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">vrrp_script chk_haproxy &#123;</span><br><span class="line">    script &quot;/usr/sbin/pidof haproxy&quot;</span><br><span class="line">    interval 2</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    interface eth0</span><br><span class="line">    state BACKUP</span><br><span class="line">    nopreempt</span><br><span class="line">    priority 101</span><br><span class="line">    virtual_router_id 10</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass password</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.20.100.30</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        chk_haproxy</span><br><span class="line">    &#125;</span><br><span class="line">    notify_master /etc/keepalived/check_haproxy.sh</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>//编辑检测脚本，为了防止haproxy服务关闭导致keepalived不自动切换<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/keepalived/check_haproxy.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">if [ $(ps -C haproxy --no-header | wc -l) -eq 0 ]; then</span><br><span class="line">       systemctl start haproxy</span><br><span class="line">fi</span><br><span class="line">sleep 2</span><br><span class="line">if [ $(ps -C haproxy --no-header | wc -l) -eq 0 ]; then</span><br><span class="line">       systemctl stop keepalived</span><br><span class="line">fi</span><br></pre></td></tr></table></figure></p>
<p>//重启启动<br>systemctl restart keepalived</p>
<p><strong>haproxy搭建</strong><br>//安装<br>yum -y install haproxy</p>
<p>//配置haproxy<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#vim /etc/haproxy/haproxy.cfg       //在末尾添加以下内容</span><br><span class="line"></span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line">listen rabbitmq_admin</span><br><span class="line">    bind 0.0.0.0:15673</span><br><span class="line">    mode tcp</span><br><span class="line">    balance roundrobin</span><br><span class="line">    option tcpka</span><br><span class="line">    option tcplog</span><br><span class="line">    timeout client 3h</span><br><span class="line">    timeout server 3h</span><br><span class="line">    timeout connect 3h</span><br><span class="line">    server mqnode1 192.168.0.101:15672</span><br><span class="line">    server mqnode2 192.168.0.102:15672</span><br><span class="line">    server mqnode3 192.168.0.103:15672</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">listen rabbitmq_cluster 0.0.0.0:5673</span><br><span class="line">    mode tcp</span><br><span class="line"></span><br><span class="line">    balance roundrobin</span><br><span class="line">    option tcpka</span><br><span class="line">    option tcplog</span><br><span class="line">    timeout client 3h</span><br><span class="line">    timeout server 3h</span><br><span class="line">    timeout connect 3h</span><br><span class="line"></span><br><span class="line">    server   mqnode1 192.168.0.101:5672 check inter 5s rise 2 fall 3</span><br><span class="line">    server   mqnode2 192.168.0.102:5672 check inter 5s rise 2 fall 3</span><br><span class="line">    server   mqnode3 192.168.0.103:5672 check inter 5s rise 2 fall 3</span><br></pre></td></tr></table></figure></p>
<p>//启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start haproxy</span><br></pre></td></tr></table></figure></p>
<p><strong>镜像模式</strong>：把需要的队列做成镜像队列，存在于多个节点，属于RabbitMQ的HA方案，在任意节点上执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl set_policy ha-all &quot;hello&quot; &apos;&#123;&quot;ha-mode&quot;:&quot;all&quot;&#125;&apos;</span><br></pre></td></tr></table></figure></p>
<p>hello 是同步的队列名，可以用正则表达式匹配；<br>{“ha-mode”:”all”} 表示同步给所有</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/20/wahaha/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/20/wahaha/" itemprop="url">wahaha-----</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-20T02:17:06+08:00">
                2019-01-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">熟悉linux操作系统的维护及日常管理工作。</span><br><span class="line">熟悉shell/python编程脚本。</span><br><span class="line">熟悉mysql,oracle的安装配置、备份及增删改查等。</span><br><span class="line">熟悉常用的集群架构：负载均衡集群（Web服务器集群、数据库集群和应用服务器集群）、高可用集群。</span><br><span class="line">熟悉nginx、redis、memcached、rabbitmq、mongo等软件的安装配置调优。</span><br><span class="line">熟悉SVN，Git的安装、配置管理与使用等。</span><br><span class="line">熟悉日志采集ELK、finder的部署、配置与管理。</span><br><span class="line">熟悉集成工具jenkins的配置使用及其分布式配置。</span><br><span class="line">熟悉监控软件zabbix，cacti的安装、配置与维护。</span><br><span class="line">对docker容器有一定的了解，熟悉dockerfile语法等。</span><br><span class="line"></span><br><span class="line">负载均衡系统：集群中所有的节点都处于活动状态，它们分摊系统的工作负载（常用的是nginx负载均衡）</span><br><span class="line">高可用集群是指以减少服务中断时间为目的的服务器集群技术</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/18/win10安装mysql/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/18/win10安装mysql/" itemprop="url">win10安装mysql</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-18T20:19:57+08:00">
                2019-01-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>win10安装mysql</p>
<p>//下载<br><a href="https://dev.mysql.com/downloads/mysql/" target="_blank" rel="noopener">https://dev.mysql.com/downloads/mysql/</a> </p>
<p>//解压:在你想安装的目录下解压，本次安装在E:\Mysql\ 下</p>
<p>//配置环境变量<br>系统变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">path</span><br><span class="line">E:\Mysql\mysql-8.0.13-winx64\bin</span><br></pre></td></tr></table></figure></p>
<p>//在E:\Mysql\mysql-8.0.13-winx64新建my-default.ini，内容如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"># 设置3306端口</span><br><span class="line">port=3306</span><br><span class="line"># 设置mysql的安装目录</span><br><span class="line">basedir=E:\Mysql\mysql-8.0.13-winx64</span><br><span class="line"># 设置mysql数据库的数据的存放目录</span><br><span class="line">datadir=E:\Mysql\mysql-8.0.13-winx64\data</span><br><span class="line"># 允许最大连接数</span><br><span class="line">max_connections=200</span><br><span class="line"># 允许连接失败的次数。这是为了防止有人从该主机试图攻击数据库系统</span><br><span class="line">max_connect_errors=10</span><br><span class="line"># 服务端使用的字符集默认为UTF8</span><br><span class="line">character-set-server=utf8</span><br><span class="line"># 创建新表时将使用的默认存储引擎</span><br><span class="line">default-storage-engine=INNODB</span><br><span class="line"># 默认使用“mysql_native_password”插件认证</span><br><span class="line">default_authentication_plugin=mysql_native_password</span><br><span class="line">[mysql]</span><br><span class="line"># 设置mysql客户端默认字符集</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[client]</span><br><span class="line"># 设置mysql客户端连接服务端时默认使用的端口</span><br><span class="line">port=3306</span><br><span class="line">default-character-set=utf8</span><br></pre></td></tr></table></figure></p>
<p>// cmd 以管理员身份运行，开始装及初始化ySQL服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Admin&gt;E:</span><br><span class="line"></span><br><span class="line">E:\&gt;cd E:\Mysql\mysql-8.0.13-winx64\bin</span><br><span class="line"></span><br><span class="line">//安装</span><br><span class="line">mysqld --install</span><br><span class="line">//初始化</span><br><span class="line">mysqld --initialize --console</span><br></pre></td></tr></table></figure></p>
<p>初始化完后会生成一个原始密码。其中root@localhost:后面的”Ng*jbnKGd2_!”就是初始密码（不含首位空格）。在没有更改密码前，需要记住这个密码，后续登录需要用到。<br>如果没保存住，也没关系。删掉初始化的 data 目录，再执行一遍初始化命令，又会重新生成的。</p>
<p>//启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net start mysql</span><br></pre></td></tr></table></figure></p>
<p>//进入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p     然后输入之前保存的密码</span><br></pre></td></tr></table></figure></p>
<p>//修改用户密码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER &apos;root&apos;@&apos;localhost&apos; IDENTIFIED WITH mysql_native_password BY &apos;新密码&apos;;</span><br><span class="line"></span><br><span class="line">CREATE USER &apos;test&apos;@&apos;%&apos; IDENTIFIED WITH mysql_native_password BY &apos;test123&apos;;            //创建用户</span><br><span class="line"></span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO &apos;test&apos;@&apos;%&apos;；  // #授权所有权限 </span><br><span class="line"></span><br><span class="line">#授权基本的查询修改权限，按需求设置</span><br><span class="line">GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP,ALTER ON *.* TO &apos;test&apos;@&apos;%&apos;;   </span><br><span class="line"></span><br><span class="line">flush privileges;    //刷新保存</span><br></pre></td></tr></table></figure></p>
<p>然后  工具就可以连接了</p>
<p>只要在CMD里输入一条命令就可以将服务删除：<br>sc delete mysql //这里的mysql是你要删除的服务名<br>这样一来服务就被删除了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/18/ELK相关/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/18/ELK相关/" itemprop="url">ELK相关</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-18T13:59:07+08:00">
                2019-01-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>//之前做es的配置，其余节点只需改node.name即可，剩下的都一样<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cluster.name: my-elk</span><br><span class="line">node.name: node-2</span><br><span class="line">path.data: /data/es-data</span><br><span class="line">path.logs: /var/log/es-log</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;172.20.100.219&quot;,&quot;172.20.100.135&quot;,&quot;172.20.100.136&quot;]</span><br></pre></td></tr></table></figure></p>
<p>//es配置参考<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@host1 ~]# vim /etc/elasticsearch/elasticsearch.yml </span><br><span class="line">cluster.name: my-elk</span><br><span class="line">node.name: node-1</span><br><span class="line">node.master: true    ##做master角色</span><br><span class="line">node.data: false     ##不做数据节点</span><br><span class="line">path.data: /var/data/es-data</span><br><span class="line">bootstrap.mlockall: true</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;172.20.100.219&quot;,&quot;172.20.100.135&quot;,&quot;172.20.100.136&quot;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@host2 ~]# vim /etc/elasticsearch/elasticsearch.yml </span><br><span class="line"></span><br><span class="line">cluster.name: my-elk</span><br><span class="line">node.name: node-2</span><br><span class="line">node.master: false   #不做master节点</span><br><span class="line">node.data: true      #只做数据节点，只负责存储数据，后期提供存储和查询服务</span><br><span class="line">path.data: /var/data/es-data</span><br><span class="line">path.logs: /var/log/es-log</span><br><span class="line">bootstrap.mlockall: true      //添加此选项，防止在内存不够用的时候，elasticsearch的内存被交换至交换区，导致性能骤降。保证了节点加入集群后的稳定性。</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;172.20.100.219&quot;,&quot;172.20.100.135&quot;,&quot;172.20.100.136&quot;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@host3 ~]# vim /etc/elasticsearch/elasticsearch.yml</span><br><span class="line">cluster.name: my-elk</span><br><span class="line">node.name: node-3</span><br><span class="line">node.master: false      ##表示host3本节点不充当，精选master角色</span><br><span class="line">node.data: true         ##表示host3节点充当数据节点</span><br><span class="line">path.data: /var/data/es-data</span><br><span class="line">bootstrap.mlockall: true</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;172.20.100.219&quot;,&quot;172.20.100.135&quot;,&quot;172.20.100.136&quot;]</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">47</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
